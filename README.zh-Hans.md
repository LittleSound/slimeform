<br>
<br>
<br>

<p align="center">
  <img height="80px" src="https://github.com/LittleSound/slimeform/raw/main/example/public/favicon.svg">
</p>

<h1 align="center">SlimeForm</h1>
<p align="center"><a href="https://github.com/LittleSound/slimeform">English</a> | ç®€ä½“ä¸­æ–‡</p>

<!-- ä¸€äº›ç¾ä¸½çš„æ ‡ç­¾ -->
<p align="center">
  <a href="https://www.npmjs.com/package/slimeform">
    <img alt="Test" src="https://badgen.net/npm/v/slimeform">
  </a>
  <a href="https://github.com/LittleSound/slimeform/actions/workflows/test.yaml">
    <img alt="Test" src="https://github.com/LittleSound/slimeform/actions/workflows/test.yaml/badge.svg">
  </a>
  <a href="#åœ¨çº¿å°è¯•">
    <img alt="docs" src="https://img.shields.io/badge/-docs%20%26%20demos-1e8a7a">
  </a>
</p>

<br>

è¡¨å•çŠ¶æ€ç®¡ç†å’Œæ•°å€¼æ ¡éªŒ

## ç”±æ¥

åœ¨ Vue é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨å„ç§é¢„åˆ¶çš„è¡¨å•ç»„ä»¶ï¼Œå®ƒå¯èƒ½æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œæˆ–è€…æ¥è‡ªç¬¬ä¸‰æ–¹ UI åº“ã€‚å¯¹äºç¬¬ä¸‰æ–¹ UI åº“è€Œè¨€ï¼Œå®ƒä»¬å¯èƒ½æœ‰è‡ªå·±çš„è¡¨å•æ ¡éªŒå™¨ï¼Œè€Œè‡ªå·±çš„ç»„ä»¶åˆ™éœ€è¦è‡ªå·±ç¼–å†™è¡¨å•æ ¡éªŒå™¨ï¼Œå¾ˆå¤šæ—¶å€™è¿™äº›è¡¨å•çš„æ ¡éªŒå™¨æ˜¯ä¸ç»Ÿä¸€çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨é¡¹ç›®ä¸­æ··åˆä½¿ç”¨ç¬¬ä¸‰æ–¹ UI åº“ å’Œè‡ªå·±çš„ç»„ä»¶æ—¶ï¼Œå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·ä¼šååˆ†å›°éš¾ã€‚

åŸºäºç°ä»£ CSS å·¥å…·ç±»å’Œç»„ä»¶åŒ–ï¼Œç¼–å†™è‡ªå·±é£æ ¼çš„ `<input>` ç»„ä»¶å¹¶å°†å®ƒä»¬ç»„åˆæˆè¡¨å•ååˆ†å®¹æ˜“ï¼Œç„¶è€Œåœ¨æ¶‰åŠåˆ°éœ€è¦æ•´åˆæ‰€æœ‰è¾“å…¥ç›¸å…³çš„è¡¨å•çŠ¶æ€ç®¡ç†å’Œè§„åˆ™æ ¡éªŒæ—¶ï¼Œé—®é¢˜å°±å˜å¾—å¤æ‚èµ·æ¥äº†ã€‚

å› æ­¤æˆ‘å¼€å§‹ä¸ºæ»¡è¶³è¿™ä¸€éœ€æ±‚è€Œå¯¹ä¸€ä¸ªè§£å†³æ–¹æ¡ˆè¿›è¡Œå®éªŒï¼Œå¹¶å°†å…¶å–åä¸º SlimeFormï¼Œå«ä¹‰ä¸ºåƒå²è±å§†ä¸€æ ·åµŒå…¥å¹¶ç²˜ç²˜æ‰€æœ‰è¡¨å• ğŸ’™ã€‚

SlimeForm æ˜¯ä¸€ä¸ª**æ— ç»„ä»¶**ã€**æ— å†…ç½®è§„åˆ™**çš„è¡¨å•çŠ¶æ€ç®¡ç†å™¨å’ŒéªŒè¯å™¨ï¼Œé€šè¿‡ `v-model` ç»‘å®šæ‰€æœ‰çš„åŸç”Ÿæˆ–è‡ªå®šä¹‰ç»„ä»¶ï¼Œå¹¶å“åº”å¼åœ°ç®¡ç†ä»¥åŠéªŒè¯å®ƒä»¬ã€‚

## å¾…åŠäº‹é¡¹

- [x] æ”¹è¿›åŠŸèƒ½
  - [x] ä½¿ç”¨ `reactive` ç±»å‹è¿”å›è¡¨å•
  - [x] å¯¹äºå•ä¸ªè§„åˆ™ï¼Œå¯ä»¥çœç•¥æ•°ç»„
  - [x] ä½¿ç”¨ `status[key].isDirty` æ ‡è®°è¡¨å•çš„å€¼æ˜¯å¦è¢«ä¿®æ”¹
- [x] æ–‡æ¡£
- [x] æ›´å¥½çš„ Typescript ç±»å‹å®šä¹‰
- [x] å•å…ƒæµ‹è¯•
- [x] æ·»åŠ å¯¹  `object` ç±»å‹å­—æ®µçš„æ”¯æŒ
- [ ] æ·»åŠ å¯¹å¼‚æ­¥è§„åˆ™çš„æ”¯æŒ
- [x] æ”¯æŒè¿‡æ»¤æœªä¿®æ”¹çš„æ¡ç›®ï¼Œåªç•™ä¸‹å·²ç»ä¿®æ”¹çš„æ¡ç›®è¿›è¡Œæäº¤
- [ ] æ”¯æŒç¬¬ä¸‰æ–¹è§„åˆ™ï¼Œæ¯”å¦‚ [yup](https://github.com/jquense/yup)
  - [x] æ”¯æŒ `validateSync`
  - [ ] æ”¯æŒ `validate`ï¼ˆå¼‚æ­¥ï¼‰
- [ ] ğŸ’¡ æ›´å¤šçš„ç‚¹å­

### æ¬¢è¿è´¡çŒ®

## åœ¨çº¿å°è¯•

ğŸš€ [slimeform-playground](https://stackblitz.com/edit/vitejs-vite-4eppne?file=package.json,src%2FApp.vue,src%2Fcomponents%2FHeader.vue,src%2Fcomponents%2FDemo.vue&terminal=dev)

## å®‰è£…

> âš—ï¸ **å®éªŒæ€§**

```shell
npm i slimeform
```

> SlimeForm ä»…æ”¯æŒ Vue 3

## ä½¿ç”¨æ–¹å¼

### è¡¨å•çŠ¶æ€ç®¡ç†

å°† `form` ç”¨ `v-model` ç»‘å®šåˆ° `<input>` æˆ–æ˜¯å…¶ä»–ç»„ä»¶ã€‚
å€¼æ”¹å˜æ—¶ `status` ä¼šäº§ç”Ÿå¯¹åº”çš„å˜åŒ–ï¼›ä½¿ç”¨ reset æ–¹æ³•é‡ç½®è¡¨å•çš„å€¼åˆ°åˆå§‹çŠ¶æ€ã€‚

```vue
<script setup>
import { useForm } from 'slimeform'

const { form, status, reset, dirtyFields } = useForm({
  // åˆå§‹çš„ form å€¼
  form: () => ({
    username: '',
    password: '',
  }),
})
</script>

<template>
  <form @submit.prevent="mySubmit">
    <label>
      <!-- è¿™é‡Œ -->
      <input v-model="form.username" type="text">
      <input v-model="form.password" type="text">
    </label>
    <button type="submit">æäº¤</button>
  </form>
</template>
```

#### çŠ¶æ€ç®¡ç†

```ts
const { form, status, reset } = useForm(/* ... */)

// username æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
status.username.isDirty
// password æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
status.password.isDirty

// é‡ç½®è¡¨å•, æ¢å¤åˆ°åˆå§‹çŠ¶æ€
reset()

// é‡ç½®æŒ‡å®šå­—æ®µ
reset('username', 'password', /* ... */)
```

### å¯å˜çš„åˆå§‹ form å€¼

`useForm` çš„è¡¨å•åˆå§‹å€¼å¯ä»¥æ˜¯å…¶å®ƒå˜é‡æˆ– pinia çš„çŠ¶æ€ï¼Œåˆå§‹å€¼çš„æ”¹å˜å°†åœ¨è¡¨å•é‡ç½®æ—¶åŒæ­¥åˆ° `form` å¯¹è±¡ä¸­

```ts
const userStore = useUserStore()

const { form, reset } = useForm({
  form: () => ({
    username: userStore.username,
    intro: userStore.intro,
  }),
})

// å‡è®¾æˆ‘ä»¬è°ƒç”¨ setInfo å‡½æ•°æ›´æ–°äº† username å’Œ intro çš„å€¼
userStore.setInfo(/* ... */)
// åœ¨è°ƒç”¨ reset æ—¶ï¼Œå¯¹ `userStore` æ‰€åšçš„æ›´æ”¹å°†åŒæ­¥åˆ° `form` å¯¹è±¡ä¸­
reset()

// è¿™äº›å±æ€§å°†æ˜¯ä¹‹å‰è°ƒç”¨è¿‡ `setInfo` ä¹‹å `userStore` çš„å€¼
form.username
form.intro
```

### ç­›é€‰å‡ºå·²ä¿®æ”¹çš„å­—æ®µ

å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¯¹ç°æœ‰æ•°æ®è¿›è¡Œç¼–è¾‘çš„è¡¨å•ï¼Œç”¨æˆ·é€šå¸¸åªä¼šä¿®æ”¹å…¶ä¸­çš„éƒ¨åˆ†å­—æ®µï¼Œç„¶åå‰ç«¯ä¼šé€šè¿‡ [HTTP  PATCH](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PATCH) å°†ç”¨æˆ·ä¿®æ”¹è¿‡çš„é‚£éƒ¨åˆ†å­—æ®µæäº¤ç»™åç«¯ï¼Œåç«¯ä¾æ®æäº¤äº†å“ªäº›å­—æ®µè¿›è¡Œå±€éƒ¨æ›´æ–°

æ­¤ç±»éœ€æ±‚å¯ä»¥ä½¿ç”¨  `dirtyFields` è®¡ç®—å‡½æ•°ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªåªä¼šåŒ…å« `form` å½“ä¸­è¢«ä¿®æ”¹è¿‡å­—æ®µçš„å¯¹è±¡ã€‚

```ts
const { form: userInfo, status, dirtyFields } = useForm(/* ... */)

dirtyFields.value /* value: {} */

// ç¼–è¾‘ç”¨æˆ·ç®€ä»‹
userInfo.intro = 'abcd'

dirtyFields.value /* value: { intro: 'abcd' } */

// ç¼–è¾‘ç”¨æˆ·ç®€ä»‹ä¸ºé»˜è®¤å€¼
userInfo.intro = '' /* default value */

dirtyFields.value /* value: {} */
```

### è¡¨å•è§„åˆ™æ ¡éªŒ

ä½¿ç”¨ `rule` å®šä¹‰è¡¨å•å­—æ®µçš„éªŒè¯è§„åˆ™ã€‚å½“å­—æ®µå€¼å‘ç”Ÿæ›´æ”¹æ—¶ï¼ŒéªŒè¯è¿‡ç¨‹å°†è‡ªåŠ¨è¿›è¡Œï¼ŒéªŒè¯ç»“æœå°†ä¼šå­˜å‚¨å’Œå‘ˆç°åœ¨ `status[key].isError` å’Œ `status[key].message` å±æ€§ä¸­ã€‚
å¦‚æœä¸€ä¸ªå­—æ®µéœ€è¦å¤šä¸ªè§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æ•°ç»„æ¥å£°æ˜ã€‚

> ä½ å¯ä»¥ç»´æŠ¤è‡ªå·±çš„è§„åˆ™é›†ï¼Œå¹¶åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹å¯¼å…¥ã€‚

```ts
// formRules.ts
export function isRequired(value) {
  if (value && value.trim()) {
    return true
  }

  return t('required') // i18n æ”¯æŒ
}
```

```vue
<script setup>
import { isRequired } from '~/util/formRules.ts'
const {
  form,
  status,
  submitter,
  clearErrors,
  isError,
  verify
} = useForm({
  // åˆå§‹ form å€¼
  form: () => ({
    name: '',
    age: '',
  }),
  // è¿›è¡Œæ ¡éªŒ
  rule: {
    name: isRequired,
    // å¦‚æœä¸€ä¸ªå­—æ®µæœ‰å¤šæ¡è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„
    age: [
      isRequired,
      // è¦æ±‚å­—æ®µæ˜¯æ•°å­— number
      val => !Number.isNaN(val) || 'Expected number',
      // è¦æ±‚å­—æ®µæœ‰æœ€å¤§å€¼
      val => val.length < 3 || 'Length needs to be less than 3',
    ],
  },
})

const { submit } = submitter(() => {
  alert(`Age: ${form.age} \n Name: ${form.name}`)
})
</script>

<template>
  <form @submit.prevent="submit">
    <!-- ... -->
  </form>
</template>
```

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨éªŒè¯é”™è¯¯æ¶ˆæ¯ä¸­ä½¿ç”¨ä»»ä½•å“åº”å¼çš„å€¼ï¼Œä¾‹å¦‚å¦‚ä¸Šæ‰€ç¤ºï¼Œå¯¹ `vue-i18n` åº“çš„å¤šè¯­è¨€å‡½æ•° `t('required')` çš„è°ƒç”¨ã€‚

<details><summary>æ‰‹åŠ¨è§¦å‘æ ¡éªŒ</summary>
<p>

```ts
const { _, status, verify } = useForm(/* ... */)
// è¡¨å•æ ¡éªŒ
verify()
// å­—æ®µæ ¡éªŒ
status.username.verify()
```

</p>
</details>

<details><summary>æ‰‹åŠ¨æŒ‡å®šé”™è¯¯</summary>
<p>

```ts
status.username.setError('username has been registered')
```

</p>
</details>

<details><summary>æ¸…é™¤é”™è¯¯</summary>
<p>

```ts
const { _, status, clearErrors, reset } = useForm(/* ... */)
// æ¸…é™¤å­—æ®µçš„é”™è¯¯
status.username.clearError()
// æ¸…é™¤å…¨éƒ¨é”™è¯¯
clearErrors()
// é‡ç½®è¡¨å•ä¹Ÿä¼šæ¸…é™¤é”™è¯¯
reset()
```

</p>
</details>

<details><summary>ä»»ä½•é”™è¯¯</summary>
<p>

`isError`: æ˜¯å¦æœ‰ä»»ä½•è¡¨å•å­—æ®µåŒ…å«é”™è¯¯çš„éªŒè¯ç»“æœ

```ts
const { _, isError } = useForm(/* ... */)

isError /* true / false */
```

</p>
</details>

<details><summary>è¡¨å•æ ¡éªŒä¿¡æ¯å ä½å†…å®¹</summary>
<p>

ä½¿ç”¨ `defaultMessage` å®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒä¿¡æ¯çš„å ä½å†…å®¹ã€‚é»˜è®¤å€¼ä¸º `''`ï¼Œä½ å¯ä»¥å°†å®ƒè®¾ç½®ä¸º `\u00A0`ï¼Œåœ¨æ¸²æŸ“æ—¶ä¼šè¢«è½¬ä¹‰ä¸º `&nbsp;`ï¼Œä»¥æ­¤æ¥é¿å…æ²¡æœ‰ message æ—¶ `<p>` å‡ºç°é«˜åº¦åå¡Œé—®é¢˜ã€‚

```ts
const { form, status } = useForm({
  form: () => ({/* ... */}),
  rule: {/* ... */},
  // æ²¡æœ‰é”™è¯¯æ¶ˆæ¯æ—¶çš„å ä½å†…å®¹
  defaultMessage: '\u00A0',
})
```

</p>
</details>

<details><summary>è§„åˆ™æ‡’æ ¡éªŒ</summary>
<p>

å°† `lazy` è®¾ç½®ä¸º `true` å¯ä»¥é˜»æ­¢æ•°æ®å˜åŒ–æ—¶è§„åˆ™è‡ªåŠ¨æ ¡éªŒã€‚

æ­¤æ—¶, å¯ä»¥è€ƒè™‘è°ƒç”¨ `verify()` æˆ– `status[fieldName].verify()` æ¥æ‰‹åŠ¨æ ¡éªŒå­—æ®µã€‚

```ts
const { form, status, verify } = useForm({
  form: () => ({
    userName: '',
    /* ... */
  }),

  rule: {
    userName: v => v.length < 3,
  },

  lazy: true,
})

form.userName = 'abc'
status.userName.isError // false

verify()

status.userName.isError // true
```

</p>
</details>

<details><summary><code>useForm()</code> è¿”å›çš„ <code>rule</code></summary>
<p>

Slimeform åœ¨ `useForm()` çš„è¿”å›å€¼ä¸­æä¾›äº† `rule`, è¯¥å­—æ®µå¯ä»¥æ ¡éªŒè¡¨å•å¤–çš„æ•°æ®ã€‚å¦‚æœæ‚¨æƒ³ç¡®ä¿æ•°æ®åœ¨ä¼ å…¥è¡¨å•ä¹‹å‰ä¸€å®šæ˜¯æ»¡è¶³è§„åˆ™çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

```ts
const { form, rule } = useForm({
  form: () => ({
    userName: '',
    /* ... */
  }),

  rule: {
    userName: v => v.length < 3 || 'to many characters',
  },
})

const myUserName = 'abcd'
if (rule.userName.validate(myUserName) === true) {
  form.userName = myUserName // won't pass into form
}
```

</p>
</details>

### æäº¤

`submitter` æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°å‚æ•°ï¼Œè¿”å›è§¦å‘è¿™ä¸ªå›è°ƒå‡½æ•°çš„å‡½æ•°å’Œè¡¨ç¤ºå‡½æ•°è¿è¡Œä¸­çš„çŠ¶æ€å˜é‡ï¼›ä¼ å…¥ `submitter` çš„å›è°ƒå‡½æ•°å¯ä»¥æ‹¿åˆ° `useForm` å‡½æ•°è¿”å›çš„æ‰€æœ‰çŠ¶æ€å’Œå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥å°†å›è°ƒå‡½æ•°æ”¾åˆ°å•ç‹¬çš„ä»£ç ä¸­ï¼Œç”šè‡³ç¼–å†™é€šç”¨çš„æäº¤å‡½æ•°ï¼Œæ–¹ä¾¿ç»„åˆä½¿ç”¨ã€‚

```vue
<script setup>
import { useForm } from 'slimeform'

const { _, submitter } = useForm(/* ... */)

// Define the submit function
const {
  // trigger submit callback
  submit,
  // Indicates whether the asynchronous commit function is executing
  submitting,
} = submitter(async ({ form, status, isError, reset /* ... */ }) => {
  // Submission Code
  const res = await fetch(/* ... */)
  // ....
})
</script>

<template>
  <form @submit.prevent="submit">
    <!-- ... -->

    <!-- Use `submitting` to disable buttons and add loading indicator -->
    <button type="submit" :disabled="submitting">
      <icon v-if="submitting" name="loading" />
      Submit
    </button>
  </form>
</template>
```

é»˜è®¤æƒ…å†µä¸‹è°ƒç”¨ `submit` å‡½æ•°åä¼šå…ˆè¿›è¡Œè¡¨å•è§„åˆ™éªŒè¯ï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œå°†ä¼šç›´æ¥ç»“æŸå‡½æ•°æ‰§è¡Œï¼Œå¦‚æœéœ€è¦å…³é—­æ­¤è¡Œä¸ºå¯ä»¥åœ¨ `submitter` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å‚æ•° `options` ä¸­é…ç½® `enableVerify: false` æ¥è·³è¿‡éªŒè¯ã€‚

#### åŒ…è£…é€šç”¨æäº¤å‡½æ•°å¹¶ä½¿ç”¨

```ts
import { mySubmitForm } from './myFetch.ts'
const { _, submitter } = useForm(/* ... */)
// Wrap the generic submission code and use it later
const { submit, submitting } = submitter(mySubmitForm({ url: '/register', method: 'POST' }))
```

## é›†æˆ

### ä½¿ç”¨ Yup ä½œä¸ºè§„åˆ™

å¦‚æœä½ ä¸æƒ³è‡ªå·±ç¼–å†™éªŒè¯è§„åˆ™çš„ç»†èŠ‚ï¼Œå·²ç»æœ‰ä¸€ç§éå¸¸ç®€æ´çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ [Yup](https://github.com/jquense/yup) ä½œä¸ºè§„åˆ™ã€‚

SlimeForm å†…ç½®äº† [Yup](https://github.com/jquense/yup) åŒæ­¥è§„åˆ™çš„è§£æå™¨ï¼š`yupFieldRule`ï¼Œä½ å¯ä»¥ä» `slimeform/resolvers` å¯¼å…¥å®ƒã€‚`yupFieldRule` å‡½æ•°åœ¨å†…éƒ¨è°ƒç”¨ `schema.validateSync` æ–¹æ³•ï¼Œå¹¶å¤„ç†ç»“æœä¸º SlimeForm å¯æ¥å—çš„æ ¼å¼ã€‚

**é¦–å…ˆï¼Œä½ è¦å®‰è£… [Yup](https://github.com/jquense/yup)**

```sh
npm install yup
```

ç„¶ååœ¨ä»£ç ä¸­å¯¼å…¥ `yup` å’Œ `yupFieldRule` å°±å¯ä»¥ä½¿ç”¨äº†

```ts
import { useForm } from 'slimeform'
import * as yup from 'yup'

/* å¯¼å…¥è§£æå™¨ */
import { yupFieldRule } from 'slimeform/resolvers'

const { t } = useI18n()

const { form, status } = useForm({
  form: () => ({ age: '' }),
  rule: {
    /* ä¸€äº›ä½¿ç”¨æ¡ˆä¾‹ */
    age: [
      yupFieldRule(yup.string()
        .required(),
      ),
      yupFieldRule(yup.number()
        .max(120, () => t('xxx_i18n_key'))
        .integer()
        .nullable(),
      ),
    ],
  },
})
```

## å»ºè®®

ä¸€äº›å»ºè®®ï¼š

1. ä½¿ç”¨ `@submit.prevent` è€Œä¸æ˜¯ `@submit` æ¥å±è”½è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
2. ä½¿ç”¨ `isError` çš„å€¼æ¥åŠ¨æ€åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦ç»™è¡¨å•è¾“å…¥æ¡†æ·»åŠ çº¢è‰²çš„æè¾¹

```vue
<template>
  <h3>è¯·è¾“å…¥ä½ çš„å¹´é¾„</h3>
  <form @submit.prevent="submitFn">
    <label>
      <input
        v-model="form.age"
        type="text"
        :class="status.age.isError && '!border-red'"
      >
      <p>{{ status.age.message }}</p>
    </label>
    <button type="submit">
      æäº¤
    </button>
  </form>
</template>
```
