<br>
<br>
<br>

<p align="center">
  <img height="80px" src="https://github.com/LittleSound/slimeform/raw/main/example/public/favicon.svg">
</p>

<h1 align="center">SlimeForm</h1>
<p align="center"><a href="https://github.com/LittleSound/slimeform">English</a> | ç®€ä½“ä¸­æ–‡</p>

<!-- ä¸€äº›ç¾ä¸½çš„æ ‡ç­¾ -->
<p align="center">
  <a href="https://www.npmjs.com/package/slimeform">
    <img alt="Test" src="https://badgen.net/npm/v/slimeform">
  </a>
  <a href="https://github.com/LittleSound/slimeform/actions/workflows/test.yaml">
    <img alt="Test" src="https://github.com/LittleSound/slimeform/actions/workflows/test.yaml/badge.svg">
  </a>
  <a href="#åœ¨çº¿å°è¯•">
    <img alt="docs" src="https://img.shields.io/badge/-docs%20%26%20demos-1e8a7a">
  </a>
</p>

<br>

è¡¨å•çŠ¶æ€ç®¡ç†å’Œæ•°å€¼æ ¡éªŒ

## ç”±æ¥

åœ¨ Vue é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨å„ç§é¢„åˆ¶çš„è¡¨å•ç»„ä»¶ï¼Œå®ƒå¯èƒ½æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œæˆ–è€…æ¥è‡ªç¬¬ä¸‰æ–¹ UI åº“ã€‚å¯¹äºç¬¬ä¸‰æ–¹ UI åº“è€Œè¨€ï¼Œå®ƒä»¬å¯èƒ½æœ‰è‡ªå·±çš„è¡¨å•æ ¡éªŒå™¨ï¼Œè€Œè‡ªå·±çš„ç»„ä»¶åˆ™éœ€è¦è‡ªå·±ç¼–å†™è¡¨å•æ ¡éªŒå™¨ï¼Œå¾ˆå¤šæ—¶å€™è¿™äº›è¡¨å•çš„æ ¡éªŒå™¨æ˜¯ä¸ç»Ÿä¸€çš„ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨é¡¹ç›®ä¸­æ··åˆä½¿ç”¨ç¬¬ä¸‰æ–¹ UI åº“ å’Œè‡ªå·±çš„ç»„ä»¶æ—¶ï¼Œå°†å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·ä¼šååˆ†å›°éš¾ã€‚

åŸºäºç°ä»£ CSS å·¥å…·ç±»å’Œç»„ä»¶åŒ–ï¼Œç¼–å†™è‡ªå·±é£æ ¼çš„ `<input>` ç»„ä»¶å¹¶å°†å®ƒä»¬ç»„åˆæˆè¡¨å•ååˆ†å®¹æ˜“ï¼Œç„¶è€Œåœ¨æ¶‰åŠåˆ°éœ€è¦æ•´åˆæ‰€æœ‰è¾“å…¥ç›¸å…³çš„è¡¨å•çŠ¶æ€ç®¡ç†å’Œè§„åˆ™æ ¡éªŒæ—¶ï¼Œé—®é¢˜å°±å˜å¾—å¤æ‚èµ·æ¥äº†ã€‚

å› æ­¤æˆ‘å¼€å§‹ä¸ºæ»¡è¶³è¿™ä¸€éœ€æ±‚è€Œå¯¹ä¸€ä¸ªè§£å†³æ–¹æ¡ˆè¿›è¡Œå®éªŒï¼Œå¹¶å°†å…¶å–åä¸º SlimeFormï¼Œå«ä¹‰ä¸ºåƒå²è±å§†ä¸€æ ·åµŒå…¥å¹¶ç²˜ç²˜æ‰€æœ‰è¡¨å• ğŸ’™ã€‚

SlimeForm æ˜¯ä¸€ä¸ª**æ— ç»„ä»¶**ã€**æ— å†…ç½®è§„åˆ™**çš„è¡¨å•çŠ¶æ€ç®¡ç†å™¨å’ŒéªŒè¯å™¨ï¼Œé€šè¿‡ `v-model` ç»‘å®šæ‰€æœ‰çš„åŸç”Ÿæˆ–è‡ªå®šä¹‰ç»„ä»¶ï¼Œå¹¶å“åº”å¼åœ°ç®¡ç†ä»¥åŠéªŒè¯å®ƒä»¬ã€‚

## å¾…åŠäº‹é¡¹

- [x] æ”¹è¿›åŠŸèƒ½
  - [x] ä½¿ç”¨ `reactive` ç±»å‹è¿”å›è¡¨å•
  - [x] å¯¹äºå•ä¸ªè§„åˆ™ï¼Œå¯ä»¥çœç•¥æ•°ç»„
  - [x] ä½¿ç”¨ `status[key].isDirty` æ ‡è®°è¡¨å•çš„å€¼æ˜¯å¦è¢«ä¿®æ”¹
- [x] æ–‡æ¡£
- [x] æ›´å¥½çš„ Typescript ç±»å‹å®šä¹‰
- [x] å•å…ƒæµ‹è¯•
- [x] æ·»åŠ å¯¹  `object` ç±»å‹å­—æ®µçš„æ”¯æŒ
- [ ] æ·»åŠ å¯¹å¼‚æ­¥è§„åˆ™çš„æ”¯æŒ
- [x] æ”¯æŒè¿‡æ»¤æœªä¿®æ”¹çš„æ¡ç›®ï¼Œåªç•™ä¸‹å·²ç»ä¿®æ”¹çš„æ¡ç›®è¿›è¡Œæäº¤
- [ ] æ”¯æŒç¬¬ä¸‰æ–¹è§„åˆ™ï¼Œæ¯”å¦‚ [yup](https://github.com/jquense/yup)
- [ ] ğŸ’¡ æ›´å¤šçš„ç‚¹å­

**æ¬¢è¿è´¡çŒ®**

## åœ¨çº¿å°è¯•

ğŸš€ [slimeform-playground](https://stackblitz.com/edit/vitejs-vite-4eppne?file=package.json,src%2FApp.vue,src%2Fcomponents%2FHeader.vue,src%2Fcomponents%2FDemo.vue&terminal=dev)

## å®‰è£…

> âš—ï¸ **å®éªŒæ€§**

```
npm i slimeform
```

> SlimeForm ä»…æ”¯æŒ Vue 3

## ä½¿ç”¨æ–¹å¼

### è¡¨å•çŠ¶æ€ç®¡ç†

å°† `form` ç”¨ `v-model` ç»‘å®šåˆ° `<input>` æˆ–æ˜¯å…¶ä»–ç»„ä»¶ã€‚
å€¼æ”¹å˜æ—¶ `status` ä¼šäº§ç”Ÿå¯¹åº”çš„å˜åŒ–ï¼›ä½¿ç”¨ reset æ–¹æ³•é‡ç½®è¡¨å•çš„å€¼åˆ°åˆå§‹çŠ¶æ€ã€‚

```vue
<script setup>
import { useForm } from 'slimeform'

const { form, status, reset } = useForm({
  // åˆå§‹çš„ form å€¼
  form: () => ({
    username: '',
    password: '',
  }),
})
</script>

<template>
  <form @submit.prevent="mySubmit">
    <label>
      <!-- è¿™é‡Œ -->
      <input v-model="form.username" type="text">
      <input v-model="form.password" type="text">
    </label>
    <button type="submit">æäº¤</button>
  </form>
</template>
```
#### çŠ¶æ€ç®¡ç†

```ts
const { form, status, reset } = useForm(/* ... */)

// username æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
status.username.isDirty
// password æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
status.password.isDirty

// é‡ç½®è¡¨å•, æ¢å¤åˆ°åˆå§‹çŠ¶æ€
reset()
```

### å¯å˜çš„åˆå§‹ form å€¼

`useForm` çš„è¡¨å•åˆå§‹å€¼å¯ä»¥æ˜¯å…¶å®ƒå˜é‡æˆ– pinia çš„çŠ¶æ€ï¼Œåˆå§‹å€¼çš„æ”¹å˜å°†åœ¨è¡¨å•é‡ç½®æ—¶åŒæ­¥åˆ° `form` å¯¹è±¡ä¸­

```ts
const userStore = useUserStore()

const { form, reset } = useForm({
  form: () => ({
    username: userStore.username,
    intro: userStore.intro,
  }),
})

// å‡è®¾æˆ‘ä»¬è°ƒç”¨ setInfo å‡½æ•°æ›´æ–°äº† username å’Œ intro çš„å€¼
userStore.setInfo(/* ... */)
// åœ¨è°ƒç”¨ reset æ—¶ï¼Œå¯¹ `userStore` æ‰€åšçš„æ›´æ”¹å°†åŒæ­¥åˆ° `form` å¯¹è±¡ä¸­
reset()

// è¿™äº›å±æ€§å°†æ˜¯ä¹‹å‰è°ƒç”¨è¿‡ `setInfo` ä¹‹å `userStore` çš„å€¼
form.username
form.intro
```

### ç­›é€‰å‡ºå·²ä¿®æ”¹çš„å­—æ®µ

å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¯¹ç°æœ‰æ•°æ®è¿›è¡Œç¼–è¾‘çš„è¡¨å•ï¼Œç”¨æˆ·é€šå¸¸åªä¼šä¿®æ”¹å…¶ä¸­çš„éƒ¨åˆ†å­—æ®µï¼Œç„¶åå‰ç«¯ä¼šé€šè¿‡ [HTTP  PATCH](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/PATCH) å°†ç”¨æˆ·ä¿®æ”¹è¿‡çš„é‚£éƒ¨åˆ†å­—æ®µæäº¤ç»™åç«¯ï¼Œåç«¯ä¾æ®æäº¤äº†å“ªäº›å­—æ®µè¿›è¡Œå±€éƒ¨æ›´æ–°

æ­¤ç±»éœ€æ±‚å¯ä»¥ä½¿ç”¨  `dirtyFields` è®¡ç®—å‡½æ•°ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªåªä¼šåŒ…å« `form` å½“ä¸­è¢«ä¿®æ”¹è¿‡å­—æ®µçš„å¯¹è±¡ã€‚

```ts
const { form: userInfo, status, dirtyFields } = useForm(/* ... */)

dirtyFields.value /* value: {} */

// ç¼–è¾‘ç”¨æˆ·ç®€ä»‹
userInfo.intro = 'abcd'

dirtyFields.value /* value: { intro: 'abcd' } */

// ç¼–è¾‘ç”¨æˆ·ç®€ä»‹ä¸ºé»˜è®¤å€¼
userInfo.intro = '' /* default value */

dirtyFields.value /* value: {} */
```

### è¡¨å•è§„åˆ™æ ¡éªŒ

ä½¿ç”¨ `rule` å®šä¹‰è¡¨å•å­—æ®µçš„éªŒè¯è§„åˆ™ã€‚å½“å­—æ®µå€¼å‘ç”Ÿæ›´æ”¹æ—¶ï¼ŒéªŒè¯è¿‡ç¨‹å°†è‡ªåŠ¨è¿›è¡Œï¼ŒéªŒè¯ç»“æœå°†ä¼šå­˜å‚¨å’Œå‘ˆç°åœ¨ `status[key].isError` å’Œ `status[key].message` å±æ€§ä¸­ã€‚
å¦‚æœä¸€ä¸ªå­—æ®µéœ€è¦å¤šä¸ªè§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æ•°ç»„æ¥å£°æ˜ã€‚

> ä½ å¯ä»¥ç»´æŠ¤è‡ªå·±çš„è§„åˆ™é›†ï¼Œå¹¶åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹å¯¼å…¥ã€‚

```ts
// formRules.ts
export function isRequired(value) {
  if (value && value.trim()) {
    return true
  }

  return t('required') // i18n æ”¯æŒ
}
```

```vue
<script setup>
import { isRequired } from '~/util/formRules.ts'
const {
  form,
  status,
  onSubmit,
  clearErrors,
  isError,
  verify
} = useForm({
  // åˆå§‹ form å€¼
  form: () => ({
    name: '',
    age: '',
  }),
  // è¿›è¡Œæ ¡éªŒ
  rule: () => ({
    name: isRequired,
    // å¦‚æœä¸€ä¸ªå­—æ®µæœ‰å¤šæ¡è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„
    age: [
      isRequired,
      // è¦æ±‚å­—æ®µæ˜¯æ•°å­— number
      val => !Number.isNaN(val) || 'Expected number',
      // è¦æ±‚å­—æ®µæœ‰æœ€å¤§å€¼
      val => val.length < 3 || 'Length needs to be less than 3',
    ],
  }),
})

function mySubmit() {
  alert(`Age: ${form.age} \n Name: ${form.name}`)
}
</script>

<template>
  <form @submit.prevent="onSubmit(mySubmit)">
    <!-- ... -->
  </form>
</template>
```

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨éªŒè¯é”™è¯¯æ¶ˆæ¯ä¸­ä½¿ç”¨ä»»ä½•å“åº”å¼çš„å€¼ï¼Œä¾‹å¦‚å¦‚ä¸Šæ‰€ç¤ºï¼Œå¯¹ `vue-i18n` åº“çš„å¤šè¯­è¨€å‡½æ•° `t('required')` çš„è°ƒç”¨ã€‚

#### æ‰‹åŠ¨è§¦å‘æ ¡éªŒ

```ts
const { _, status, verify } = useForm(/* ... */)
// è¡¨å•æ ¡éªŒ
verify()
// å­—æ®µæ ¡éªŒ
status.username.verify()
```

#### æ‰‹åŠ¨æŒ‡å®šé”™è¯¯

```ts
status.username.setError('username has been registered')
```

#### æ¸…é™¤é”™è¯¯

```ts
const { _, status, clearErrors, reset } = useForm(/* ... */)
// æ¸…é™¤å­—æ®µçš„é”™è¯¯
status.username.clearError()
// æ¸…é™¤å…¨éƒ¨é”™è¯¯
clearErrors()
// é‡ç½®è¡¨å•ä¹Ÿä¼šæ¸…é™¤é”™è¯¯
reset()
```

#### ä»»ä½•é”™è¯¯

`isError`: æ˜¯å¦æœ‰ä»»ä½•è¡¨å•å­—æ®µåŒ…å«é”™è¯¯çš„éªŒè¯ç»“æœ

```ts
const { _, isError } = useForm(/* ... */)

isError /* true / false */
```

#### è¡¨å•æ ¡éªŒä¿¡æ¯å ä½å†…å®¹

ä½¿ç”¨ `defaultMessage` å®šä¹‰è¡¨å•å­—æ®µæ ¡éªŒä¿¡æ¯çš„å ä½å†…å®¹ã€‚é»˜è®¤å€¼ä¸º `\u00A0` ï¼Œåœ¨æ¸²æŸ“æ—¶ä¼šè¢«è½¬ä¹‰ä¸º `&nbsp;` ï¼Œä»¥æ­¤æ¥é¿å…æ²¡æœ‰ message æ—¶ `<p>` å‡ºç°é«˜åº¦åå¡Œé—®é¢˜ã€‚

å¦‚æœä¸éœ€è¦è¿™ä¸ªé¢„è®¾ï¼Œå¯ä»¥å°† `defaultMessage` è®¾ç½®ä¸º `''` æˆ–ä»»ä½•ä½ æƒ³è¦çš„å ä½å†…å®¹ã€‚

```vue
<script setup>
const {
  form,
  status,
  onSubmit,
  clearErrors,
  isError,
  verify
} = useForm({
  // åˆå§‹ form å€¼
  form: () => ({
    name: '',
  }),
  // è¿›è¡Œæ ¡éªŒ
  rule: () => ({
    name: val => (val && val.trim()) || 'Required',
  }),
  // æ²¡æœ‰é”™è¯¯æ¶ˆæ¯æ—¶çš„å ä½å†…å®¹
  defaultMessage: '',
})

function mySubmit() {
  alert(`Name: ${form.name}`)
}
</script>

<template>
  <form @submit.prevent="onSubmit(mySubmit)">
    <label>
      <input
        v-model="form.name"
        type="text"
        :class="status.name.isError && '!border-red'"
      >
      <p>{{ status.name.message }}</p>
    </label>
    <button type="submit">
      æäº¤
    </button>
  </form>
</template>
```

### å»ºè®®

ä¸€äº›å»ºè®®ï¼š
1. ä½¿ç”¨ `@submit.prevent` è€Œä¸æ˜¯ `@submit` æ¥å±è”½è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
2. ä½¿ç”¨ `isError` çš„å€¼æ¥åŠ¨æ€åœ°åˆ¤æ–­æ˜¯å¦éœ€è¦ç»™è¡¨å•è¾“å…¥æ¡†æ·»åŠ çº¢è‰²çš„æè¾¹

```vue
<template>
  <h3>è¯·è¾“å…¥ä½ çš„å¹´é¾„</h3>
  <form @submit.prevent="onSubmit(mySubmit)">
    <label>
      <input
        v-model="form.age"
        type="text"
        :class="status.age.isError && '!border-red'"
      >
      <p>{{ status.age.message }}</p>
    </label>
    <button type="submit">
      æäº¤
    </button>
  </form>
</template>
```



